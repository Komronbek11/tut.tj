<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Список СРС</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* НОВОЕ: Система переменных для темной/светлой темы */
        :root {
            --bg-color: #f0f2f5;
            --text-color-primary: #1a202c;
            --text-color-secondary: #4a5568;
            --card-bg: rgba(255, 255, 255, 0.65);
            --border-color: rgba(0, 0, 0, 0.1);
            --skeleton-bg: #e2e8f0;
            --aurora-opacity: 0.25;
        }

        html.dark {
            --bg-color: #0b1120;
            --text-color-primary: #e2e8f0;
            --text-color-secondary: #a0aec0;
            --card-bg: rgba(23, 37, 62, 0.5);
            --border-color: rgba(255, 255, 255, 0.1);
            --skeleton-bg: rgba(255, 255, 255, 0.1);
            --aurora-opacity: 0.4;
        }

        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color-primary);
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        .aurora-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; overflow: hidden; z-index: -1; }
        @keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .aurora-shape { position: absolute; border-radius: 50%; filter: blur(120px); opacity: var(--aurora-opacity); animation: rotate 50s infinite linear; transition: opacity 0.5s ease; }
        .aurora-1 { width: 600px; height: 600px; background: #10b981; top: -200px; right: -200px; }
        .aurora-2 { width: 500px; height: 500px; background: #3b82f6; bottom: -150px; left: -150px; animation-duration: 55s; }
        
        .assignment-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        .assignment-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); }
        .card-image { height: 180px; background-size: cover; background-position: center; }
        
        /* Стили для таблиц внутри карточек */
        .description-content table { width: 100%; margin-top: 1rem; border-collapse: collapse; }
        .description-content th, .description-content td { 
            border: 1px solid var(--border-color); 
            padding: 8px; 
            font-size: 0.875rem; 
        }
        .description-content p { margin-bottom: 0.5rem; } /* Добавляем отступ для параграфов */

        /* Стили для Skeleton Loader */
        @keyframes skeleton-pulse { 50% { opacity: 0.5; } }
        .skeleton-pulse { animation: skeleton-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .skeleton-card .skeleton-img { height: 180px; background-color: var(--skeleton-bg); }
        .skeleton-card .skeleton-text { height: 1rem; border-radius: 0.25rem; background-color: var(--skeleton-bg); }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">

    <div class="aurora-container">
        <div class="aurora-shape aurora-1"></div>
        <div class="aurora-shape aurora-2"></div>
    </div>

    <header class="text-center mb-10">
        <h1 class="text-3xl sm:text-4xl font-bold">Задания для самостоятельной работы (СРС)</h1>
        <p class="text-lg mt-2" style="color: var(--text-color-secondary);">Список актуальных заданий от преподавателей</p>
    </header>

    <main id="assignments-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <div class="assignment-card rounded-xl overflow-hidden skeleton-card">
            <div class="skeleton-img skeleton-pulse"></div>
            <div class="p-5 space-y-3">
                <div class="skeleton-text w-3/4 skeleton-pulse"></div>
                <div class="skeleton-text w-full skeleton-pulse"></div>
                <div class="skeleton-text w-1/2 skeleton-pulse"></div>
            </div>
        </div>
        <div class="assignment-card rounded-xl overflow-hidden skeleton-card">
            <div class="skeleton-img skeleton-pulse"></div>
            <div class="p-5 space-y-3">
                <div class="skeleton-text w-3/4 skeleton-pulse"></div>
                <div class="skeleton-text w-full skeleton-pulse"></div>
                <div class="skeleton-text w-1/2 skeleton-pulse"></div>
            </div>
        </div>
        <div class="hidden lg:block assignment-card rounded-xl overflow-hidden skeleton-card">
            <div class="skeleton-img skeleton-pulse"></div>
            <div class="p-5 space-y-3">
                <div class="skeleton-text w-3/4 skeleton-pulse"></div>
                <div class="skeleton-text w-full skeleton-pulse"></div>
                <div class="skeleton-text w-1/2 skeleton-pulse"></div>
            </div>
        </div>
        <div class="hidden xl:block assignment-card rounded-xl overflow-hidden skeleton-card">
            <div class="skeleton-img skeleton-pulse"></div>
            <div class="p-5 space-y-3">
                <div class="skeleton-text w-3/4 skeleton-pulse"></div>
                <div class="skeleton-text w-full skeleton-pulse"></div>
                <div class="skeleton-text w-1/2 skeleton-pulse"></div>
            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // НОВОЕ: Логика для автоматического переключения темы
        const themeMatcher = window.matchMedia('(prefers-color-scheme: dark)');
        const toggleDarkTheme = (isDark) => document.documentElement.classList.toggle('dark', isDark);
        toggleDarkTheme(themeMatcher.matches);
        themeMatcher.addEventListener('change', (e) => toggleDarkTheme(e.matches));

        const firebaseConfig = {
            apiKey: "AIzaSyCAOfxPW5m2UqtulWzuh3egOjJ-ti-rDf8",
            authDomain: "register-221e5.firebaseapp.com",
            projectId: "register-221e5",
            storageBucket: "register-221e5.appspot.com",
            messagingSenderId: "588640206529",
            appId: "1:588640206529:web:b2abf5413387e251935e40"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const assignmentsRef = db.ref('assignments');
        
        const assignmentsGrid = document.getElementById('assignments-grid');

        const renderAssignments = (assignments) => {
            assignmentsGrid.innerHTML = '';
            if (assignments.length === 0) {
                assignmentsGrid.innerHTML = `<p class="col-span-full text-center py-10" style="color: var(--text-color-secondary);">На данный момент нет активных заданий.</p>`;
                return;
            }

            assignments.forEach(item => {
                const card = document.createElement('div');
                // Класс flex и flex-col заставляют карточку растягиваться по высоте содержимого
                card.className = 'assignment-card rounded-xl overflow-hidden flex flex-col'; 
                const placeholderImg = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSUJTkdQF599AX8UYJq7VPnXMWi7dWjlCUecg&s';
                const imageUrl = item.imageUrl || placeholderImg;

                card.innerHTML = `
                    <div class="card-image" style="background-image: url('${imageUrl}')"></div>
                    <div class="p-5 flex-grow flex flex-col">
                        <span class="text-sm font-semibold text-blue-500">${item.subject}</span>
                        
                        <div class="description-content my-2 flex-grow">${item.description}</div>
                        
                        <p class="text-sm mt-3" style="color: var(--text-color-secondary);">Преподаватель: ${item.teacherName}</p>
                        <div class="mt-4 text-xs font-semibold bg-gray-200 text-gray-700 rounded-full px-3 py-1 text-center dark:bg-gray-700 dark:text-gray-200">
                            Сроки: ${new Date(item.startDate).toLocaleDateString()} - ${new Date(item.endDate).toLocaleDateString()}
                        </div>
                    </div>
                `;
                assignmentsGrid.appendChild(card);
            });
        };

        assignmentsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            const assignments = [];
            if (data) {
                for (let id in data) {
                    assignments.push({ id, ...data[id] });
                }
            }
            renderAssignments(assignments.reverse());
        });
    </script>
</body>
</html>